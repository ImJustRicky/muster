<p align="center">
  <img src="assets/banner.png" alt="muster" width="100%" />
</p>

<p align="center">
  Universal deploy framework with a beautiful TUI. Pure bash, zero dependencies, fully modular.
</p>

---

**muster** gives any project a polished deploy experience — interactive dashboard, health checks, rollback, log streaming — regardless of stack. It doesn't know how to deploy your app. It knows how to run your scripts beautifully and verify everything works.

## Install

```bash
curl -fsSL https://raw.githubusercontent.com/ImJustRicky/muster/main/install.sh | bash
```

Or clone manually:

```bash
git clone https://github.com/ImJustRicky/muster.git ~/.muster/repo
ln -s ~/.muster/repo/bin/muster ~/.local/bin/muster
ln -s ~/.muster/repo/bin/muster-mcp ~/.local/bin/muster-mcp
```

Or add to your shell profile (`.zshrc` / `.bashrc`):

```bash
export PATH="$PATH:/path/to/muster/bin"
```

## Quick Start

```bash
cd your-project
muster setup       # guided wizard — scans project, creates deploy.json + hook scripts
muster             # open the dashboard
```

Or skip the wizard entirely with flags:

```bash
muster setup --scan                                     # auto-detect everything
muster setup --stack k8s --services api,redis,worker    # explicit
muster setup --scan --health api=http:/health:3000      # scan + custom health
muster setup --help                                     # see all flags
```

## Commands

| Command | Description |
|---------|-------------|
| `muster` | Dashboard — live health/status view with action menu |
| `muster setup` | Guided setup wizard, or use flags for non-interactive (`--help`) |
| `muster deploy` | Deploy all services (respects deploy order) |
| `muster deploy api` | Deploy a specific service |
| `muster status` | Check health of all services |
| `muster logs` | Stream logs (interactive service picker) |
| `muster rollback` | Rollback a service |
| `muster cleanup` | Clean up stuck processes and old logs |
| `muster settings` | View and edit project settings |
| `muster uninstall` | Remove muster from project |
| `muster skill add <url>` | Install a skill addon |
| `muster skill list` | List installed skills |
| `muster skill remove <name>` | Remove a skill |

## How It Works

muster is an **orchestrator**, not a deployment tool. Your project provides hook scripts that do the actual work — muster runs them in order, shows beautiful output, and verifies health.

### Smart Setup

`muster setup` scans your project first — detects Dockerfiles, docker-compose configs, Kubernetes manifests, language files, and config references. It identifies your stack (k8s, compose, docker, or bare metal) and discovers services automatically.

You confirm what it found, set deploy order, configure health checks and credentials per service, and muster generates **real working hook scripts** from stack-specific templates — not empty stubs.

If nothing is detected (empty project), it falls back to a conversational question flow.

### Setup creates this in your project:

```
your-project/
├── deploy.json              ← config (generated by setup wizard)
└── .muster/
    └── hooks/
        ├── api/
        │   ├── deploy.sh    ← real deploy commands for your stack
        │   ├── health.sh    ← real health check
        │   ├── rollback.sh  ← real rollback logic
        │   ├── logs.sh      ← log streaming
        │   └── cleanup.sh   ← cleanup stale resources
        └── redis/
            ├── deploy.sh
            ├── health.sh
            └── ...
```

### deploy.json

Clean, human-readable config:

```json
{
  "project": "myapp",
  "version": "1",
  "services": {
    "api": {
      "name": "API Server",
      "health": {
        "type": "http",
        "endpoint": "/health",
        "port": 8080,
        "timeout": 10,
        "enabled": true
      },
      "credentials": {
        "mode": "off"
      }
    },
    "redis": {
      "name": "Redis",
      "health": {
        "type": "tcp",
        "port": 6379,
        "timeout": 5,
        "enabled": true
      }
    }
  },
  "deploy_order": ["redis", "api"]
}
```

Operations without hooks are silently skipped — no errors, no empty menu items.

## Credentials

Off by default. Three modes per service:

1. **Save always** — stored in macOS Keychain (via `security` command). Persists across sessions.
2. **Once per session** — prompted once, kept in memory for the session.
3. **Every time** — prompted on every deploy/rollback.

**Never** in deploy.json. **Never** in your project directory. **Never** in git.

Services with stored credentials are flagged with `! KEY` in the dashboard.

## Settings

`muster settings` lets you toggle per-service options interactively:

- **Skip deploy** — health-check only, don't deploy
- **Health check** — enable/disable health verification
- **Credentials** — cycle through Off / Save always / Once per session / Every time

Changes are saved directly to deploy.json.

## Skills

Community addons that extend muster:

```bash
muster skill add https://github.com/someone/muster-skill-ssl
muster skill add https://github.com/someone/muster-skill-notify
```

Skills are bash scripts with a `skill.json` manifest. See [docs/skills.md](docs/skills.md) for how to create one.

## MCP Integration

muster includes an MCP (Model Context Protocol) tool so LLMs can deploy, check status, rollback, and manage your services directly. Pure bash, runs locally over stdio.

### Claude Desktop

Add to `~/Library/Application Support/Claude/claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "muster": {
      "command": "muster-mcp"
    }
  }
}
```

### Claude Code

Add to `.claude/settings.json`:

```json
{
  "mcpServers": {
    "muster": {
      "command": "muster-mcp"
    }
  }
}
```

### Available tools

| Tool | Description |
|------|-------------|
| `muster_scan_project` | Detect project files and suggest services |
| `muster_init_project` | Create deploy.json and hook directories |
| `muster_write_hook` | Write a hook script (deploy, health, rollback, etc.) |
| `muster_read_hook` | Read an existing hook script |
| `muster_status` | Health check all services |
| `muster_deploy` | Deploy all or a specific service |
| `muster_rollback` | Rollback a service |
| `muster_logs` | Get recent deploy logs |
| `muster_cleanup` | Clean up old logs and run cleanup hooks |
| `muster_list_services` | List services with hook availability |
| `muster_config` | Get the full deploy.json |

An LLM can scan your project, create the config, write all the hook scripts, then deploy — all through conversation. Requires `jq`.

## LLM Documentation

- [`llms.txt`](llms.txt) — concise project index for LLMs
- [`llms-full.txt`](llms-full.txt) — expanded reference with architecture, config format, and bash 3.2 compatibility notes

## Philosophy

- **Pure bash** — zero runtime dependencies, runs anywhere
- **Modular** — each file does one thing
- **Your scripts, your way** — muster orchestrates, you decide how things deploy
- **Stack agnostic** — Docker, k8s, bare metal, cloud — if you can script it, muster can run it
- **Beautiful by default** — spinners, progress bars, live log boxes, color-coded everything

## Contributing

PRs welcome. The codebase is modular by design — each file in `lib/` is self-contained.

## License

MIT
